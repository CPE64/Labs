%|  CSUS CPE64/EEE64 Verilog Labs: Lab Two
%|
%|  language: LaTeX
%|  Author: Ben Smith
%| 
%|  This source generates the lab manual document when compiled using a LaTeX processor.  All packages are included in a full
%|  installation of a LaTeX System.  
%|
%| 
%| 
\title{Lab Two: Introduction to logic on the FPGA}
\author{Ben Smith}
\input{./../../ProjectWideTex/header.tex}

\begin{document}
\maketitle

  \begin{abstract}
    This document is an introduction to the DE0-Nano development board, Altera's Cyclone IV FPGA and the Quartus IDE. The block editor feature of Quartus is used to synthesize logic gate primitives and more complex logic functions from these primitives. The synthesis of these simple structures allows the student to gain experience with the development tools used by the DE0-Nano Development board.
  \end{abstract}

  %| =================================================================================================
  %| Introduction
  %| =================================================================================================
  \section{Introduction}
    \PARstart{T}{his} lab introduces the DE0-Nano development board and Altera's Quartus development environment. Quartus will be used to program the Altera Cyclone IV FPGA on the Terasic DE0-Nano development board.\footnote{FPGAs remained a mystery to me for quite some time, this video does a great job of discussing the benefits and drawbacks of the devices \href{https://www.youtube.com/watch?v=gUsHwi4M4xE}{EEV Blog: What is a FPGA?}}  The schematic entry method  will be very similar to the  design entry method that have experience with in Multisim. This first lab will follow the same processes that you implemented with discrete 7400 series logic ICs. The only difference is now the discrete logic can be implemented using the FPGA. The Cyclone IV could implement 3300 2-input nand gates, go ahead and breadboard that.This lab is intended to introduce the student to the following concepts:
    \begin{itemize}
       \item Logic primitives on a FPGA
       \item Quartus development environment
       \item Synthesis of a block based design
       \item Assigning pins for a design
       \item Programming an Altera FPGA
    \end{itemize}

    \subsection{Included Screencasts}
      A number of screencasts are included with this set of labs. They are available on Youtube and as zipped MP4s on the course website. They are intended to be short and to the point so they cover individual topics.
      \begin{enumerate}
        \item TIME - Installing Quartus
        \item TIME - Opening, Compiling, programming with Quartus
        \item TIME - Block editor in Quartus
        \item TIME - Using the generated pin assignments from the TerasIC system builder
      \end{enumerate}

    \subsection{DE0-Nano Development board}
      The DE0-Nano has a number of peripheral devices built into the board to expand the capabilities of the FPGA. Interacting with most of these will be beyond the scope of this course but represent real world design challenges and are worth experimenting with after this basic course is completed. Altera offers a number of tutorials for anyone interested in learning more. These labs will mostly use one of the 40-pin GPIO headers to interact with the outside world. Let's take a moment to recognise the potential of this development board should you choose to pursue it. Figure \ref{DEOBlockDia} shows a high level diagram of the development board. There is much more information available in the DE0-Nano manual but the highlights are all here. The SDRAM can be used to store large amounts of information for fast access, great for a ``soft processor''\footnote{A soft processor is a microcontroller implemented inside of the FPGA. These softprocessors can be programmed in languages like C for more standard development processes that typically are much faster than HDL languages. The advantage of this method is the ability to build the microcontroller to need using a hardware descriptive language}. The EEPROM allows program memory that does not clear with power reset, also very useful for a soft processor. The A/D converter allows analog voltages to be read which allows the development board to interact with the outside world. It also features an accelerometer that will refresh at rates up to 1600Hz.      \begin{figure}[htpb]
        \includegraphics[width=.48\textwidth]{Images/DEONanoBlockDiagram.png}
        \caption{Block Diagram of DE0-Nano \cite{DE0Manual}}
        \label{DEOBlockDia}
      \end{figure}
      The A/D converter and G-sensor will be great tools to interact with sensors in your later classes. If you choose to go down a path of controls engineering FPGAs will be a great way to implement ``deterministic''\footnote{a deterministic system is a system in which no randomness is involved in the development of future states of the system. A deterministic model will thus always produce the same output from a given starting condition or initial state.\cite{DynamicSystems}} Control systems. Interfacing with these components will require the implementation of a SPI or I2C bus protocol. The De0-Nano system CD comes with some example code that uses these devices that would get the interested student off the ground in no time.

  %| =================================================================================================
  %| Procedure
  %| =================================================================================================
  \section{Lab Procedure}
    \PARstart{T}{his} section is a guide for what must be accomplished in the lab. Keep in mind, the some of the following material will need to be documented in your lab report. It would behoove you to take a look at the lab report section before starting the procedure. Recording results of experiments will be stressed because the documentation of what you do is the most important part. To begin these labs you will need:
    \begin{itemize}
      \item De0-Nano Development board
      \item A breadboard
      \item Four LEDs with 200$\Omega$ current limiting resistors
      \item Two dip switches with 200$\Omega$ pulldown resistors
      \item Windows or Linux based computer
      \item Internets
    \end{itemize}
    
    %| Step One: Introduction to DE0-Nano Board
    %| =================================================================================================
    \subsection{Getting start with your DE0-Nano}
      Altera's University program provides excellent tutorials for Quartus. This first tutorial covers installation of drivers for the DE-Series board. This is information will only be pertenent to those installing quartus on their own computer. \href{ftp://ftp.altera.com/up/pub/Altera_Material/13.0/Tutorials/Schematic/Quartus_II_Introduction.pdf}{Getting Started with DE0-Series boards} 

    %| Step One: Introduction to Quartus
    %| =================================================================================================
    \subsection{Lab Part One: LED controller with onboard devices.}
      The included document \href{ftp://ftp.altera.com/up/pub/Altera_Material/13.0/Tutorials/Schematic/Quartus_II_Introduction.pdf}{Quartus II Introduction} shows how to use the graphical editor feature of quartus. Use the two schematics above to create a way to interact with the FPGA. Dont worry about section 8 
      of the Quartus Introduciton, we'll cover simulators later. The product of this tutorial will be the first lab demo for this lab.

    %| Required Lab Demo
    %| =================================================================================================
    \vspace{15px}
    \begin{centering}
      \begin{fminipage}{.43\textwidth}
        \vspace{3px}
        \centering{\bfseries \large Laboratory Demo: Light Controller}\\*
        \vspace{10px}
        \begin{tabular}{p{1.8cm}  p{5.4cm}}
          %|==Requirements for lab demo==
          \raggedright Physical deliverable:        &Programmed DE0-Nano. \\
          \\
          \raggedright Documentation deliverable:   &Screen capture of .BDF Schematic of design\\
          \\
          Process :                                 & The student will be asked the demonstrate the proper operation of their design by cycling through the switches.
        \end{tabular}
      \end{fminipage}
    \end{centering}

    %| Step Three: Prepare circuit
    %| =================================================================================================
    \subsection{Lab Part Two: Interacting with external devices though GPIO}
      A switch and LED are going to be used to test the FPGA while it's operating. This switch will allow you to generate input for the FPGA. Figure \ref{LEDCircuit} LED circuit needs a current limiting resistor.
      \begin{figure}[htpb]
        \includegraphics[width=.48\textwidth]{Schematics/LED.pdf}
        \caption{LED with current limiting resistor}
        \label{LEDCircuit}
      \end{figure}
      The LED will allow you to see the the output but we'll also need to be able to generate some input for the FPGA. We will do this with a dip switch and pulldown resistor. The pulldown resistor is needed to literally pull the charge off the wire so the input will read a solid zero. Otherwise the pin would ``float'' between 1 and 0 arbitrarily. CMOS devices tend to float to the high state, 

      \begin{figure}[htpb]
        \includegraphics[width=.38\textwidth]{Schematics/SwitchCircuit.pdf}
        \caption{Switch with pulldown resistor}
        \label{swPulldown}
      \end{figure}

      %| GPIO Headers
      \subsubsection{GPIO headers on the DE0-Nano} 
        Be careful when referencing the pin diagrams in the DE0-Nano user manual. It is easy to read it backwards, that cost you hours. It is easiest to match the Nano's orientation with the schematic and count from the nearest edge. Figure \ref{pinmap} shows GPIO 0 next to a schematic of the header. Always check VCC\_SYS, VCC3P3, and GND with a multimeter before attaching a circuit you have built.        \begin{figure*}
          \centering
          \begin{subfigure}[b]{.38\textwidth}
            \includegraphics[angle=270, width=.9\textwidth]{Images/LabeledGPIOHeaders.jpg}
            \caption{Orientation of GPIO Header\cite{DE0Manual}}
          \end{subfigure}
          \begin{subfigure}[b]{.45\textwidth}
            \includegraphics[width=\textwidth]{Images/GPIOHeader.jpg}
            \caption{Schematic of GPIO-0 header\cite{DE0Manual}}
          \end{subfigure}
          \caption{GPIO0 and its orientation on the development board}
          \label{pinmap}
        \end{figure*}
        This is the header pin schematic from the DE0-Nano user manual. Inside the Verilog code, these pins follow a different nomenclature. What is labeled as GPIO\_0\_IN[0] in figure 5 is GPIO0\_IN[0] and GPIO\_00 is GPIO0[0]. Refer to the DE0-Nano user guide for details on the orientation of the headers.        

      %| Step Eight: Create AOI module from equation
      %| =================================================================================================
      \subsection{Design AOI module from logical equation} 
        The ``And or Invert'' function is common in digital design. You will implement it with logic primitives in the schematic editor. There will be a wealth of information available online about how to implement the function on the Internet but take a stab at it before heading to Google.

      \begin{displaymath}
        F = \overline{(A \wedge B) \vee (C \wedge D)}
      \end{displaymath}

      %| Required Lab Demo
      %| =================================================================================================
      \vspace{15px}
      \begin{centering}
        \begin{fminipage}{.43\textwidth}
          \vspace{3px}
          \centering{\bfseries \large Laboratory Demo: AOI Gate}\\*
          \vspace{10px}
          \begin{tabular}{p{1.8cm}  p{5.4cm}}
            %|==Requirements for lab demo==
            \raggedright Physical deliverable:                   &4 dipswitch inputs and 1 LED outputs with appropriate pulldown and current limiting resistors for the DE0-Nano Development board. \\
            \\
            \raggedright Documentation deliverable:   & Labeled schematic of circuit with I/O pins labeled with FPGA pin number and Verilog net name,  truth table from your  experimental result.\\
            \\
            Process :                                                                      &The student will be asked the result of a few random numbers to verify the correct operation of their circuit.
          \end{tabular}
        \end{fminipage}
      \end{centering}

  %| =================================================================================================
  %| Lab Report Requirements
  %| =================================================================================================
  \section{Lab Report}
    \IEEEPARstart{T}{he} lab report must be typed and submitted in a PDF format. Look to \href{http://www.ieee.org/conferences_events/conferences/publishing/templates.html}{IEEE's guidelines} on format. I would reccomend  using the word template they provide, it will ensure professional looking documents without much effort. The document should include the following items.
    
    \subsection{Figures to include}
    \begin{itemize}
      \item Schematic of your Light Controller module.
      \item Schematic of your AOI module.
    \end{itemize}

    \subsection{Questions to answer}
    \begin{enumerate}
      \item Notice the report that pops up when you compile your project. There are a number of statistics given by Quartus, the logic element usage ratio is your designs use of the total device capacity. What was the logic usage of your FPGA?
      \item The synthesis engine in Quartus is very powerful and will optimize your design for the resources on the FPGA. If you look at the post-fit netlist viewer, Quartus generates the design using three logic gates and two inverters, which gate was changed an inverter?
      \item This lab uses a graphical design entry method. What advantages do you see in this method,  what drawbacks?
    \end{enumerate}

  %| =================================================================================================
  %| Conclusions
  %| =================================================================================================
  \section{Conclusion}
    \IEEEPARstart{T}{this} lab introduced Quartus and some of it's basic functionality. Quartus is very similar to many industry standard tools. Xilinx, another manufacturer of programmable logic devices, offers a tool suite very similar to Quartus called ISE. Although we will not discuss ISE, a understanding of Quartus will allow ISE to be learned very quickly. These are tools that you can expect to see in Industry as a CPE or EEE student. There is an extreme demand right now for engineers with an understanding of programmable logic.

  %| =================================================================================================
  %| Bibliography
  %| =================================================================================================
  \input{../../ProjectWideTex/Bibliography}

\end{document}