%| Weekly report template for CSUS Senior Design
%|
%| language: LaTeX
%| Author: Ben Smith
%| 
%| This source has been tagged with the "<CHANGE" tag in areas
%| that require updating when making a new docuent
%|
%| This source will generate a PDF file complete with thumbnails navigation menu and metadata.
%| Much of the tex awesomeness comes from http://www.michaelshell.org/ praise be to him for creating the guide

\documentclass[12pt,journal]{IEEEtran}

\newcommand{\TITLE}{Lab One: Introduction to Verilog}
\newcommand{\KEYWORDS}{Logic Gates, Verilog, FPGA, Signaltap, Synthesis}
\newcommand{\ABSTRACT}{Two input logic gates are synthesized for the Altera Cyclone IV FPGA using the Quartus IDE. The logic
                       gates are verified using a System Verilog testbench and Mentor's Modelsim HDL simulator}

%| Override compsoc class' Palatino font for body text, restores to Times New Roman
\renewcommand{\rmdefault}{ptm}\selectfont

%| IEEE Citation package
\usepackage{cite}

\usepackage[cmex10]{amsmath}        %| Asmerican Mathematical Society package for fancy maths  
\interdisplaylinepenalty=2500       %| Restores IEEE line spacing after amsmath

%| Better tables than LaTeX 2e
\usepackage{array}
\usepackage{graphicx}
\usepackage{float}
\usepackage{url}                    %| Improved URL handling
\usepackage{minted}
\usepackage{etoolbox}
%\AtBeginEnvironment{minted}{\singlespacing
%    \fontsize{9}{p}\selectfont}

\usepackage{listings}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\lstset{ %
  backgroundcolor=\color{mygray},     % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\footnotesize\ttfamily,  % the size of the fonts that are used for the code
  breakatwhitespace=false,            % sets if automatic breaks should only happen at whitespace
  breaklines=true,                    % sets automatic line breaking
  captionpos=b,                       % sets the caption-position to bottom
  commentstyle=\color{mygreen},       % comment style
  deletekeywords={...},               % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},             % if you want to add LaTeX within your code
  extendedchars=true,                 % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=single,                       % adds a frame around the code
  keepspaces=true,                    % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},          % keyword style
  language=Verilog,                   % the language of the code
  morekeywords={*,...},               % if you want to add more keywords to the set
  numbers=left,                       % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                      % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray},    % the style that is used for the line-numbers
  rulecolor=\color{black},            % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                   % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,             % underline spaces within strings only
  showtabs=false,                     % show tabs within strings adding particular underscores
  stepnumber=1,                       % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},        % string literal style
  tabsize=2,                          % sets default tabsize to 2 spaces
  title=\lstname                      % show the filename of files included with \lstinputlisting; also try caption instead of title
}

%| Enables PDF metadata, thumbnails, and navigation
\newcommand\MYhyperrefoptions{
  bookmarks=true,
  bookmarksnumbered=true,
  pdfpagemode={UseOutlines},
  plainpages=false,
  pdfpagelabels=true,
  colorlinks=true,
  linkcolor={black},
  citecolor={black},
  urlcolor={blue},
  pdftitle={CPE/EEE 64: Lab One},
  pdfsubject={Engineering},                        
  pdfauthor={California State University Sacramento},
  pdfkeywords={\KEYWORDS}}                       

%| Calls hyperref package with the options specified above
\usepackage[\MYhyperrefoptions,pdftex]{hyperref}

\begin{document}
%| Inserts header cover sheet 
\include{Title_Page}
\include{TOC}


  %| =================================================================================================
  %| Introduction
  %| =================================================================================================
  \section{\bfseries Introduction}
    \PARstart{V}{erilog} is a powerful way to describe circuits. Logic diagrams like those being used in lecture 
    can become cumbersome in large designs. ``Text based design entry'' can be less prone to error because 
    it is easier to track differences in large designs. Verilog is a text based hardware descriptive language
    the begun being used in ASIC(Application Specific Integrated Circuit) and now is the language of choice for
    FPGAs(Field Programmable Gate Array). We will be using the Terasic DE0-Nano development board with an Altera 
    Cyclone IV FPGA on board. Altera provides a comprehensive solution for programming and debugging their FPGAs 
    called Quartus. These labs will explore Quartus and use it to program the FPGA on the DE0-Nano development 
    board. In this lab we will:
    \begin{itemize}
      \item Instantiate a System Verilog module
      \item Use a System Verilog Testbench
      \item Interact with external switches and indicators
      \item Synthesize Verilog code for a FPGA
    \end{itemize}
  
    \subsection{\bfseries Verilog Modularity}
      One of the most important features of Verilog is it's ability to reuse a design. Reusing code allows you to
      rapidly assemble and test new designs. The ability to rapidly prototype a design is one the biggest advantages 
      to the FPGA. This section will involve provided logic gate Verilog modules which will be reused in later labs to 
      build more complex structures. Reusing these modules is very similar to how you would reuse code in the workplace 
      to be more productive. The lab documentation comes with Verilog implementations of the four logic gates in 
      {\bfseries Source.zip} The demo for the lab will be implementing these modules with the DE0-Nano development
      board and testing the design on a breadboard. You could think of this as the source libraries that would
      be available at the company that you might work for. 

    \subsection{\bfseries Test Bench}
      Verilog roughly breaks into two halves synthesizable and non-synthesizable. FPGAs synthesis can
      take a very long time, using a simulator to verify individual modules can be much faster than
      resynthesizing the entire design. The Testbench also offers a unique ability to check expected
      outputs generate test stimulus. We will use a test bench to check the provided Verilog modules
      are providing the desired operation in part C of the procedure. This simulation should be verified
      against the known truth table for the logic gate to ensure the module is accurate.

  %| =================================================================================================
  %| Procedure
  %| =================================================================================================
  \section{\bfseries Lab Procedure}
    \PARstart{T}{his} section is a guide for what must be demonstrated to the laboratory instructor 
    and documented in your lab report. For this section you will need:
    \begin{itemize}
      \item DE0-Nano Development board
      \item A breadboard
      \item Four LEDs
      \item Two dip switches
      \item Windows or Linux based computer
      \item Internets
    \end{itemize}

    \subsection{\bfseries Install Quartus}
    Download most recent version of Quartus and Cyclone device drivers from Altera. Screencast 1
    is a walk through for windows, but Quartus is also available for Linux.

    %| Step One: Expand source .zip
    %| =================================================================================================
    \subsection{\bfseries Expand Source.Zip}
    The Quartus project file, logic gate modules, and test bench are contained within this archive. 
    Expand it wherever is convenient for you, it will be accessed frequently. The Quartus project file
    included with the source code is generated with the Terasic DE0-Nano System Builder that is included
    with the Terasic System CD. You can use this if you want to generate a clean project for yourself.
    \begin{figure}[H]
      \includegraphics[width=.48\textwidth]{Images/screenshot_88.jpg}
      \caption{TerasIC System Builder GUI}
    \end{figure}
    
    %| Step Two: Compile and run testbench
    %| =================================================================================================
    \subsection{\bfseries Run testbench}
    Now we want to verify our design. Using a simulator for a single logic gate is a bit asinine but
    the experience gained with the example test bench will help you greatly in the future. Start a new simulation 
    and add the waveforms as shown in screencast 2. You'll want to have have truth tables laid out for the
    gates your testing so you can be sure they behave the way you expect. Have an extra column ready to record
    the behavior of the FPGA once it's programed. Figure \ref{LogicOut} shows an example of what the wave section
    should look like.
    \begin{figure}[H]
      \label{LogicOut}
      \includegraphics[width=.48\textwidth]{Images/LogicOutput.png}
      \caption{Example output of testbench}
    \end{figure}
    Take a moment to look at the simulation transcript, it provides the states of the logic elements being tested.
    I prefer having the simulator give a test listing instead of reading the waveforms. This is from the \$display()
    lines in the testbench. listing the outputs can be a very powerful debugging tool. I typically use the \$assert()
    statement which can pause the simulation and alert you when an unexpected result is produced.
    \begin{lstlisting}
A:0 B:0 - Inverter:1 AND:0 OR:0 NAND:1
A:0 B:1 - Inverter:1 AND:0 OR:1 NAND:1
A:1 B:0 - Inverter:0 AND:0 OR:1 NAND:1
A:1 B:1 - Inverter:0 AND:1 OR:1 NAND:0
    \end{lstlisting}

    
    %| Step Three: Prepare circuit
    %| =================================================================================================
    \subsection{\bfseries Prepare circuit to test Verilog gate modules with DE0-Nano}
      A switch and LED are going to be used to test the FPGA while it's operating. This will allow you to generate
      inputs for the FPGA with the switches. The LED circuit needs a current limiting resistor as shown in the 
      Figure below.
      \begin{figure}[H]
        \label{LEDCircuit}
        \includegraphics[width=.48\textwidth]{Schematics/LED.pdf}
        \caption{LED with current limiting resistor}
      \end{figure}
      The LED will allow you to see the the output but we'll also need to be able to generate some input for
      the FPGA. We will do this with a dip switch and pulldown resistor. The pulldown resistor is needed
      to literally pull the charge off the wire so the input will read a solid zero. Otherwise the pin would ``float''
      between 1 and 0 arbitrarily.
      \begin{figure}[H]
        \label{swPulldown}
        \includegraphics[width=.48\textwidth]{Schematics/SwitchCircuit.pdf}
        \caption{Switch with pulldown resistor}
      \end{figure}

      %| GPIO Headers
      \subsubsection{\bfseries GPIO headers on the DE0-Nano}
        Be careful when referencing the pin diagrams in the DE0-Nano user manual. It is easy to read it backwards and
        that can be a mistake that will cost you hours. It is easiest to match the Nano's orientation with the schematic
        and count from the nearest edge. Always check VCC\_SYS, VCC3P3, and GND with a multimeter before attaching a circuit
        you have built. 
        \begin{figure}[H]
          \includegraphics[width=.48\textwidth]{Images/GPIOHeader.jpg}
          \caption{Schematic of GPIO-0 header\cite{DE0Manual}}
        \end{figure}
        This is the header pin schematic from the DE0-Nano user manual. Inside the verilog code these pins follow a little
        different nomenclature. What is labeled as GPIO\_0\_IN0 in figure 5 is GPIO0\_IN[0] and GPIO\_00 is GPIO0[0]. Refer
        to the DE0-Nano user guide for details on the orientation of the headers.

        \begin{figure}[H]
          \includegraphics[width=.45\textwidth]{Images/GPIOpicture.jpg}
          \caption{Picture of loaded GPIO-0 header}
        \end{figure}

        \begin{figure}[H]
          \includegraphics[width=.48\textwidth]{Images/ExampleLayout.jpg}
          \caption{Example switch and LED configuration with SIP resistors}
        \end{figure}

      %| Step Five: Compile
      \subsubsection{\bfseries Compile example code with Quartus}
        Once you've created and tested your switch circuit we'll need to compile the example code. This can be done
        with the Quartus development environment. A walk through is provided in screencast X. 

      %| Step Six: Program Nano
      \subsubsection{\bfseries  Use Quartus to program the Nano} refer to screencast 2 for a walk through. After synthesis
      Quartus will generate a .SOF\footnote{the .SOF stands for SRAM object file. This is an Altera standard for
      of their FPGAs.} file that can be used to program the FPGA using Quartus' programmer. Follow the procedure
      outlined in screencast X.
        
      %| Step Seven: Record Results
      %| =================================================================================================
      \subsection{\bfseries Test behavior against expected truth table} Use your table from the simulation

      %| Step Eight: Record Results
      %| =================================================================================================
      \subsection{\bfseries Write XOR module} 
      Now that you've had the opportunity to experiment with the provided modules the time had come to write
      your own module. When starting a module it's usually best to copy something you know works and modify it
      to suit your need. In this case I would make a copy of AND.sv and change the logic to XOR. Verilog does
      have a built in operator for this. Your best friend is google, that's always the best place to start.

  %| =================================================================================================
  %| Lab Report Requirements
  %| =================================================================================================
  \section{\bfseries  Lab Report}
    The lab report must be typed and submitted in a PDF format. Look to IEEE's guidelines for formatting guidelines
    on format. The document should include
    \subsection{\bfseries Figures to include}
    \begin{itemize}
      \item Waveform captures from Modelsim
      \item Logic tables from theoretical prediction and experimental outcome
      \item Explanation and listing of your XOR Verilog module.
    \end{itemize}

    \subsection{\bfseries Questions to answer}
    \begin{itemize}
      \item There are multiple ways to instantiate a module what are three different ways that you could
            instantiate the AND module included with this lab?
      \item Compiling a programming language like C and synthesizing Verilog are very different even though they
            appear to be the same in the IDE. How might 
      \item Notice the report that pops up when you compile your project. There are a number of statistics given
            by Quartus, the logic element usage ratio is your designs use of the total device capacity. More Verilog
            roughly translates into more LC usage. What was your designs Logic Cell utilization?. 
    \end{itemize}

  %| =================================================================================================
  %| Conclusions
  %| =================================================================================================
  \section{\bfseries Conclusion}
    Verilog is an IEEE standard(1364)\cite{Wikipedia:Verilog}, it is pervasive in industry and can be used to develop specialized hardware
    in the form of ASICs or reconfigurable FPGAs. It is important to underscore the differences between Verilog
    and a programming language like C, Java, even Assembly. Verilog offers the ability to take parallel action.
    Two numbers can be multiplied at once, multiple registers can be set and cleared. Entire microprocessors can
    be implemented on the Nano, one of the later labs will explore Altera's softprocessor the NIOS II. The TerASIC
    documentation included with the DE0-Nano kit is pretty good and worth the read. It will help you get the most
    out of the FPGA. The CD included with the Nano will also include circuit schematics that can provide a great
    reference when it comes time to make one of your own.
    
    \paragraph{\bfseries More Information} just like anything else the Internet has an amazing amount of information available
    on the Internet to the interested student. 
      \begin{itemize}
        \item \href{http://www.altera.com/education/training/curriculum/fpga/trn-fpga.html}{Altera Traning Curriculum for FPGA designers}
        \item \href{www.eevblog.com}{EEV Blog: What is a FPGA?}
      \end{itemize}

  %| =================================================================================================
  %| Bibliography
  %| =================================================================================================
  \bibliographystyle{IEEEtran}
  \bibliography{IEEEfull}
\end{document}