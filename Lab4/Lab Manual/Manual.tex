%| Weekly report template for CSUS Senior Design
%|
%| language: LaTeX
%| Author: Ben Smith
%| 
%| This source has been tagged with the "<CHANGE" tag in areas
%| that require updating when making a new docuent
%|
%| This source will generate a PDF file complete with thumbnails navigation menu and metadata.
%| Much of the tex awesomeness comes from http://www.michaelshell.org/ praise be to him for creating the guide

\title{Lab Four: Shift registers, Counters}
\author{Ben Smith}

\input{./../../ProjectWideTex/header.tex}
\begin{document}

  \maketitle
    \begin{abstract}
      This document introduces concepts related to the implementation of Registers and Timers in the System Verilog hardware descriptive language. The effects of register timing, metastability and the FPGA timing closure process are breifly discussed.
    \end{abstract}
%| =================================================================================================
%| Introduction
%| =================================================================================================
\section{Introduction}
  \PARstart{T}{his} lab will reinforce the idea of modularity as we design modules which depend on a clocking signal. Clocking circuits allows the synchronization of large blocks of logic. The concepts this lab introduces are at the core of design with Verilog. The sensitivity list will allow you to communicate with a number of different devices on different system clocks greatly expanding the usefulness of the FPGA. It is important to remember that each one of these blocks evaluates simultaneously, the behavioral block is at the core of Verilog's parallel nature. 

  %| Clocked designs in Verilog
  %| =================================================================================================
  \subsection{Clocked designs in Verilog}

    \subsubsection{Posedge and Negedge in the sensitivity list}
      These operators are commonly used in the sensitivity list of a logical block in Verilog. They indicate where operations are performed on a square wave clock signal. Posedge performs the specified operation at the low to high transition and negedge the high to low edge.
    
    \subsubsection{Register metastability and timing closure}
      ``Timing Closure'' is the process of making sure the physical circuits on the FPGA (or any digital system) and produce a desired functionality. The electrical properties of capacitance and inductance limit the maximum operating frequency of a circuit, even on the nanometer scale on the FPGA. The systems that are built in this lab do not approach the abilities of the Cyclone FPGA we are using. But the topic is very important, it has been one of the first questions i have been asked on a job interview. If you would like to learn about the topic (not required) Altera's white paper \href{http://www.altera.com/literature/wp/wp-01082-quartus-ii-metastability.pdf}{01082} offers a technical discussion of metastability and how to mitigate the effects of the phenomenon.

  %| Blocking and non blocking operators
  %| =================================================================================================
  \subsection{Blocking and non blocking operators}
    Verilog statements can be structured by using two different assignments. These two types of statements must be used to avoid race conditions when your code is synthesized. Once again Clifford Cummings offers a great insight into the operation of these language constructs. 
      
    \subsubsection{Blocking assignments \bfseries ( = )} 
      Blocking assignments occur in one step, all other operations are ``paused'' while waiting for the operation to complete.Evaluate the RHS (right-hand side equation) and update the LHS (left-hand side expression) of the blocking assignment without interruption from any other Verilog statement.''\cite{Sunburst:BlockNoBlock}

    \subsubsection{Non-Blocking assignments \bfseries ( $<$= )} 
      The evaluation of nonblocking assignments is a bit more complex than the blocking operator and requires special consideration. The execution of these statements is defined as follows. This is how the logic synthesizer schedules the specified operations as it processes the Verilog design you have created. This information is particularly relevant in the simulator as you try to debug your design. 
      \begin{enumerate}
        \item Evaluate the RHS of nonblocking statements at the beginning of the time step.
        \item Update the LHS of nonblocking statements at the end of the time step.
      \end{enumerate}
      \cite{Sunburst:BlockNoBlock}

    \subsubsection{Tips for the effective use of behavioral blocks}
      The following tips come form A paper discussing the use of blocking and non-blocking statements in Verilog 
      \begin{itemize}
        \item When modeling sequential logic, use nonblocking assignments.
        \item When modeling latches, use nonblocking assignments.
        \item When modeling combinational logic with an always block, use blocking assignments.
        \item When modeling both sequential and combinational logic within the same always block, use nonblocking assignments.
        \item Do not mix blocking and nonblocking assignments in the same always block.
        \item Do not make assignments to the same variable from more than one always block.
        \item Use \$strobe to display values that have been assigned using non blocking assignments.
      \end{itemize}

  %| Clock division with registers
  %| =================================================================================================
  \subsection{Clock division with Counters}
    The idea of a clock divider in verilog is identical to a divider with discrete logic. Because of the timing constraints on the FPGA, a synchronous counter is the best option for our requirements. If one d flip-flop divides a clock by two, then the addition of another will divide the input clock by four and so on. this can be generalized to $$f_{out}=\frac{f_{in}}{\text{number of bits in register}}$$
    
%| =================================================================================================
%| Procedure
%| =================================================================================================
\section{Lab Procedure}
  \subsection{Investigating timing closure}
    Altera provides a tutorial on the basics of using the TimeQuest Timing analyzer. The effective use of this tool is critical to a successful design. Complete the \href{ftp://ftp.altera.com/up/pub/Altera_Material/13.0/Tutorials/Timequest.pdf}{Altera tutorial} and include the contents of the generated timing constraints file (.SDC) in your lab report.

  \subsection{Application of registers: Timers}
    The DE0-Nano has a 50MHz crystal oscillator and this is input to the FPGA clock pin.  This clock must used to trigger operations every second and every 2 milliseconds. The operations are triggered by a pulse longer than 100 microseconds. Measure the frequency  of this trigger signal using a debugging tool like Signaltap or output the signal to pins and measure the output with an oscilloscope.
     
    %| Required Lab Demo
    %| =================================================================================================
    \vspace{15px}
    \begin{centering}
      \begin{fminipage}{.45\textwidth}
        \vspace{3px}
        \centering{\bfseries \large Laboratory Demo}\\*
        \vspace{10px}
        \begin{tabular}{p{1.8cm}  p{5.4cm}}
          %|==Requirements for lab demo==
          \raggedright Physical deliverable:         & Constructed circuit on breadboard,  the Nano generating timing signals.\\
          \\
          \raggedright Documentation deliverable:    & Labeled schematic of circuit,  oscilloscope capture of signal with timing information.\\
          \\
          Process :                                  & The student will be asked to show the device in operation.

        \end{tabular}
      \end{fminipage}
    \end{centering} 

  \subsection{Application of Shift Registers: IO expansion}
    This sections focuses on a application of the shift register. It can be found in a number of uses like the serialization and de-serialization of data streams. A common trick to expand IO on a device is to use the venerable HC595 shift register. The data for the output pins can be output serially to the shift register instead of directly parallel. This trades update speed and code complexity for IO pin usage. Let's take some indicator LED's for example. They do not need to be updated frequently and we can save the complex IO pins on the FPGA for other purposes. 

  %| Required Lab Demo
  %| =================================================================================================
  \vspace{15px}
  \begin{centering}
    \begin{fminipage}{.43\textwidth}
      \vspace{3px}
      \centering{\bfseries \large Laboratory Demo}\\*
      \vspace{10px}
      \begin{tabular}{p{1.8cm}  p{5.4cm}}
        %|==Requirements for lab demo==
        \raggedright Physical deliverable:           & Constructed circuit on breadboard,  the Nano programmed with your AOI module.\\
        \\
        \raggedright Documentation deliverable:      & Labeled schematic of circuit,  truth table from your  experimental result.\\
        \\
        Process :                                    & The student will be asked the result of a few random numbers to verify the correct operation of their circuit.
      \end{tabular}
    \end{fminipage}
  \end{centering} 

%| =================================================================================================
%| Lab Report Requirements
%| =================================================================================================
\section{\bfseries  Lab Report}
  
%| =================================================================================================
%| Conclusions
%| =================================================================================================
\section{\bfseries  Conclusion}
 
%| =================================================================================================
%| Bibliography
%| =================================================================================================
\input{../../ProjectWideTex/Bibliography}

\end{document}